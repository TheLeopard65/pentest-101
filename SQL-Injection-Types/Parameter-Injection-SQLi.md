# Parameter Injection SQL Injection (SQLi) Guide

Parameter Injection SQL Injection (SQLi) occurs when user-supplied data is improperly handled by an application and directly used in SQL queries. This vulnerability is a specific type of SQL Injection where malicious data is injected into parameters that are passed to SQL queries, which may not be properly sanitized or validated. This can lead to unauthorized data access, modification, or execution of arbitrary SQL commands.

## Steps to Perform Parameter Injection SQLi

### 1. **Identify Injection Points**
1. **Explore the Application**: Look for parameters in URLs, form fields, HTTP headers, or cookies that are used to interact with the database. Common places to check include:
   - URL query strings (e.g., `http://example.com/product?id=1`)
   - Form submissions (e.g., search fields, login forms)
   - HTTP headers (e.g., `Referer`, `User-Agent`)
   - Cookies

2. **Test Basic SQL Injection**: Inject basic SQL payloads into these parameters to determine if they are vulnerable. Examples include:
     ```SQL
     '
     "
     ' OR '1'='1
     ```

### 2. **Determine Parameter Handling**
1. **Analyze Parameter Usage**: Determine how the application uses these parameters in SQL queries. This involves:
   - Reviewing the applicationâ€™s response to different inputs.
   - Understanding how parameters are passed to the SQL server, either directly or through application logic.

2. **Test for Direct Execution**: Use payloads to test if the parameter is directly included in SQL queries. Example payloads:
     ```SQL
     ' AND 1=1 --
     ' AND 1=2 --
     ```

### 3. **Extract Data Using Parameter Injection**
1. **Determine the Type of Query**: Understand the type of SQL queries that the application is running. For example, it might use SELECT queries to fetch data or INSERT queries to add data. This will help tailor your payloads.

2. **Craft Injection Payloads**: Use payloads based on the type of SQL query. Example payloads include:
   - **Extract Data**:
     ```SQL
     ' UNION SELECT NULL, username, password FROM users --
     ```
   - **Retrieve Database Information**:
     ```SQL
     ' UNION SELECT NULL, @@version --
     ```

3. **Inject and Observe**: Inject the crafted payload into the identified parameter and observe the response. Check if the response contains unintended data or errors, which indicate successful injection.

### 4. **Advanced Exploitation**
1. **Error-Based SQL Injection**: Inject payloads that cause SQL errors to reveal database structure or other information:
     ```SQL
     ' AND 1=CONVERT(int, (SELECT @@version)) --
     ```

2. **Blind SQL Injection**: If no direct output is observed, use blind SQLi techniques:
   - **Boolean-Based Blind SQLi**:
     ```SQL
     ' AND 1=1 -- (true condition)
     ' AND 1=2 -- (false condition)
     ```
   - **Time-Based Blind SQLi**:
     ```SQL
     ' OR IF(1=1, SLEEP(5), 0) -- (delays response if condition is true)
     ```

3. **Second-Order Injection**: If initial tests do not show results, the parameter might be stored and used later. Follow second-order SQLi techniques to exploit it:
   - **Store Malicious Data**: Inject payloads into parameters that store data for future queries.
   - **Trigger Stored Payload**: Access or use stored data to execute the payload.

### 5. **Verify and Document Findings**

1. **Verify Vulnerability**: Confirm that the payloads are correctly injected and executed. Ensure that the responses indicate successful SQL injection.
2. **Document Results**: Record the details of your findings, including:
   - Injection points and payloads used
   - Data extracted or modified
   - Application behavior and impact
   - Capture screenshots or save request/response logs as evidence.

3. **Assess Impact**: Evaluate the potential impact of the SQL injection vulnerability based on the data retrieved or modified. Consider risks such as unauthorized access, data leakage, or system compromise.

4. **Prepare Recommendations**: Provide recommendations for mitigating SQLi vulnerabilities, such as:
   - Using parameterized queries or prepared statements
   - Implementing robust input validation and output encoding
   - Restricting database permissions and privileges
   - Regularly reviewing and updating security practices

## EXAMPLE SCENARIO: Testing a Product Search Parameter

1. **Identify Injection Point**: Suppose there is a search parameter in the URL, such as `http://example.com/products?search=tv`.

2. **Test Basic SQL Injection**: Inject a basic payload into the search parameter:
     ```SQL
     http://example.com/products?search=tv'
     ```

3. **Determine Parameter Handling**: Analyze how the parameter is used in SQL queries. Observe if the application displays SQL errors or unexpected results.

4. **Extract Data**:
   - **Retrieve Data**:
     ```SQL
     http://example.com/products?search=tv' UNION SELECT NULL, username, password FROM users --
     ```
   - **Database Information**:
     ```SQL
     http://example.com/products?search=tv' UNION SELECT NULL, @@version --
     ```

5. **Verify and Document**: Confirm that the payloads work and document the findings. Capture evidence and assess the impact of the vulnerability.

## Conclusion

Parameter Injection SQL Injection involves injecting malicious SQL into parameters used in SQL queries. By understanding how these parameters are handled and exploited, you can effectively test for and demonstrate SQLi vulnerabilities. 

Always ensure you have explicit permission to perform penetration testing and adhere to ethical guidelines during your assessment.
