# Stored SQL Injection (SQLi) Guide

Stored SQL Injection occurs when an attacker injects malicious SQL code into an application that stores the input in a database. This injected code is then executed later when the stored data is retrieved and used in SQL queries. Stored SQLi can be particularly dangerous because it can persist across multiple interactions with the application and affect other users.

## Steps to Perform Stored SQL Injection

### 1. **Identify Injection Points**
1. **Explore the Application**: Look for input fields where user data is accepted and stored in the database. Common targets include:
   - Registration forms
   - Comment sections
   - Feedback or review forms
   - Profile update forms

2. **Submit Test Inputs**: Enter basic SQL injection payloads to check if the input is being processed in a way that could lead to SQL injection. Example payloads include:
     ```SQL
     '
     "
     ' OR '1'='1
     ```

### 2. **Confirm Data Storage**
1. **Verify Data Storage**: Ensure that your input is stored in the application. This can be done by:
   - Checking if the data persists after submission and can be viewed later.
   - Reviewing how the application displays or uses the stored data (e.g., on a profile page, comment section, or search results).

2. **Inspect Stored Data**: Confirm that the input is stored in the database. This may involve:
   - Viewing the stored data through application features (e.g., viewing a user profile, comments, or logs).
   - Using administrative or debugging features if available to check the database.

### 3. **Identify Execution Points**
1. **Locate Execution Context**: Identify where and how the stored data is used in SQL queries. For example:
   - Search functionalities that use stored data in queries
   - Displaying user-generated content, such as comments or reviews
   - Admin panels that query data based on user input

2. **Test Execution Points**: Inject payloads at execution points where the stored data is used to see if it triggers a SQL injection. Example payloads might include:
     ```SQL
     ' OR '1'='1' --
     ```

### 4. **Exploit Stored SQLi**

1. **Craft Malicious Payloads**: Prepare payloads that can exploit the stored data when it is used in SQL queries. Example payloads include:
   - **SQL Injection in Comments**:
     ```SQL
     ' UNION SELECT NULL, username, password FROM users --
     ```
   - **SQL Injection in Feedback Forms**:
     ```SQL
     '; DROP TABLE users; --
     ```

2. **Trigger the Stored Payload**: Perform actions that cause the stored data to be processed. This can involve:
   - Searching for or viewing the data that includes the malicious payload
   - Accessing pages or functionalities that use the stored input in SQL queries

3. **Extract or Modify Data**: Depending on the nature of the SQL injection, you may:
   - **Extract Data**: Use payloads to retrieve information from the database.
   - **Modify Data**: Inject commands to alter the database schema or contents.

### 5. **Verify and Document Findings**

1. **Verify Vulnerability**: Ensure that the SQL injection payload works as intended and that the data stored in the database is executed in the SQL query.
2. **Document Results**: Record details of your findings, including:
   - Injection points and payloads used
   - Data extracted or modified
   - Application behavior changes and impact
   - Capture screenshots or save request/response logs as evidence.

3. **Assess Impact**: Evaluate the impact of the SQLi vulnerability based on the data retrieved or modified. Consider the potential risks and implications.

4. **Prepare Recommendations**: Provide recommendations for mitigating stored SQLi vulnerabilities, such as:
   - Using parameterized queries or prepared statements to prevent SQL injection
   - Implementing robust input validation and sanitization
   - Regularly reviewing and updating security measures
   - Applying least privilege principles to database accounts

## EXAMPLE SCENARIO: Testing a Comment Section

1. **Identify Injection Point**: Suppose you have a comment section on a blog where users can submit comments.

2. **Submit Test Inputs**: Inject a SQL payload into the comment field:
     ```SQL
     ' OR '1'='1' --
     ```

3. **Verify Data Storage**: Check if the comment with the SQL payload is stored and viewable in the comments section.

4. **Locate Execution Points**: Identify where the stored comments are used in SQL queries, such as when displaying comments on a post.

5. **Trigger and Exploit Payload**: View the comments section to see if the payload affects the SQL query. For example:
   - **Extract Data**: If the payload allows for data extraction:
     ```SQL
     ' UNION SELECT NULL, username, password FROM users --
     ```
   - **Modify Data**: If the payload allows for data modification:
     ```SQL
     '; DROP TABLE users; --
     ```

## Conclusion

Stored SQL Injection involves injecting malicious SQL into an application that stores user input in the database. This stored input is then executed later when the data is used in SQL queries. By understanding where and how the stored data is used, you can exploit this vulnerability to extract or modify data.

Always ensure you have explicit permission to perform penetration testing and adhere to ethical guidelines during your assessment.
